#!/usr/bin/env ruby
$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'rubygems'
require 'nautilus'
require 'fileutils'

def usage
  "Usage: #{File.basename(__FILE__)} create new_project_name"
end

case ARGV[0]
when 'create', '--create'
  Nautilus.run("git clone git@github.com:newtonlabs/nautilus-project.git #{ARGV[1]}")
  Dir.glob("#{ARGV[1]}/**/*").each do |file|
    Nautilus.search_and_replace(file, "nautilus", ARGV[1])
    Nautilus.search_and_replace(file, "Nautilus", ARGV[1].capitalize)
  end
  
  # Clear git history
  FileUtils.rm_rf ("#{ARGV[1]}/`.git")
  
  # TODO Change the secret_token.rb
  # Nautilus.search_and_replace secret_token.rb
when 'help', '--help'
  puts usage
else
  puts "Unknown subcommand: #{ARGV[0]}\n#{usage}"
end